{% extends 'layout.html' %}
{% block body %}

<div class="row px-0" id="row0">
  <div class="col-sm-12">
    <ul class="list-group mb-auto">
      <li class="list-group-item d-flex justify-content-between lh-condensed bg-info">
        <h3 class="mx-auto text-white">Fitted Ship Builder</h3>
        <input name="fetch" class="btn-sm btn-primary mt-0" type="button" value="<">..
        <input name="fetch" class="btn-sm btn-primary mt-0" type="button" value=">">
      </li>
      <li class="list-group-item d-flex justify-content-between lh-condensed p-1">
        <div class="col-12">
          <form action="{{ url_for('fittings')}}" method="POST">
            <div class="form-inline" id="row1">
              <div class="form-group pr-1">
                {% if myFittingsCount > 0 %}
                  <img class="img-fluid max-width:auto" src="https://imageserver.eveonline.com/Render/{{myFittings[fittingIndex].ship_id}}_128.png">
                {% elif ship_id > 0 %}
                  <img class="img-fluid max-width:auto" src="https://imageserver.eveonline.com/Render/{{ship_id}}_128.png">
                {% else %}
                  <img class="img-fluid max-width:auto" src="https://imageserver.eveonline.com/Render/670_128.png">
                {% endif %}
              </div>
              <label class="px-1" for="ship">Ship to Build:</label>
              <div class="form-group">
                <select name="ship_id" id="ship" class="form-control" style="max-width: 300px;">
                  {% if myFittingsCount > 0 %}
                    <option selected value="{{myFittings[0].ship_id}}">{{myFittings[fittingIndex].ship_name}}</option>
                  {% elif ship_id > 0 %}
                    <option selected value="{{ship_id}}">{{ship_name}}</option>
                  {% else %}
                    <option selected value="0">Choose...</option>
                  {% endif %}
                  {% for ship in ships %}
                    <option value="{{ ship.id }}">{{ ship.ship }}</option>
                  {% endfor %}
                </select>
              </div>
                <label class="px-1" for="qty">QTY:</label>
                <div class="form-inline">
                  {% if myFittingsCount > 0 %}
                    <input type="text" class="form-control" name="qty" value="{{myFittings[fittingIndex].qty}}" size="1">
                  {% else %}
                    <input type="text" class="form-control" name="qty" value="1" size="1">
                  {% endif %}
                </div>
                <label class="px-1" for="contract">Contract Price:</label>
                <div class="form-inline pr-1">
                  {% if myFittingsCount > 0 %}
                    <input type="text" class="form-control" name="contract_sell_price" value="{{ "{:,.0f}".format(myFittings[fittingIndex].contract_sell_price) }}" style="width: 150px;">
                  {% else %}
                    <input type="text" class="form-control" name="contract_sell_price" value="0" style="width: 150px;">
                  {% endif %}
                </div>
                <div class="form-inline form-check px-1">
                  {% if myFittingsCount > 0 %}
                    {% if myFittings[fittingIndex].rollup == 1 %}
                      <input class="form-check-input" type="checkbox" name="rollup" checked>
                    {% else %}
                      <input class="form-check-input" type="checkbox" name="rollup">
                    {% endif %}
                  {% else %}
                    <input class="form-check-input" type="checkbox" name="rollup">
                  {% endif %}
                  <label class="form-check-label" for="rollup">Rollup?</label>
                </div>
                <div class="form-inline pr-1">
                  {% if myFittingsCount > 0 %}
                    <button class="btn btn" type="submit" name="action" value="edit">
                      <i class="fas fa-pencil-alt" title="Edit This Fitting"></i></button>
                    <button class="btn btn" type="submit" name="action" value="delete">
                      <i class="fas fa-trash-alt" title="Delete This Fitting"></i></button>
                    <button class="btn btn" type="submit" name="action" value="new">
                      <i class="fas fa-plus-square" title="Add New Fitting"></i></button>
                  {% elif ship_id > 0 %}
                    <button class="btn btn" type="submit" name="action" value="edit">
                    <i class="fas fa-pencil-alt" title="Edit This Fitting"></i></button>
                    <button class="btn btn" type="submit" name="action" value="new">
                    <i class="fas fa-plus-square" title="Add New Fitting"></i></button>
                  {% else %}
                    <button class="btn btn" type="submit" name="action" value="new">
                      <i class="fas fa-plus-square" title="Add New Fitting"></i></button>
                  {% endif %}
                </div>

            </div><!-- row1 -->


            <div class="form" id="row2">
              <table class="table table-light">
                <tbody>
                  <tr>
                    <td class="noBorder text-center"><strong>High Slots</td>
                    <td class="noBorder text-center"><strong>Medium Slots</td>
                    <td class="noBorder text-center"><strong>Low Slots</td>
                  </tr>
                  <tr>
                    <td>
                      <table class="table table-light">
                        <tbody>
                          {% if ship_id > 0 %}
                          {% for n in range(1, num_highslots+1) %}
                            <tr>
                              <td class="noBorder py-0 bg-info">
                                <select name="hi{{n}}" class="form-control form-control-sm" style="max-width: 400px;">
                                  {% if myFittingsHigh %}
                                    {% if myFittingsHigh[n-1].component_id > 0 %}
                                      <option selected value="{{myFittingsHigh[n-1].component_id}}">{{myFittingsHigh[n-1].component}}</option>
                                    {% else %}
                                      <option selected value="0">Choose...</option>
                                    {% endif %}
                                  {% else %}
                                    <option selected value="0">Choose...</option>
                                  {% endif %}
                                  {% for module in high_modules %}
                                    <option value="{{module.id}}">{{module.item}}</option>
                                  {% endfor %}
                                </select>
                              </td>
                            </tr>
                            {% endfor %}
                            {% endif %}
                        </tbody>
                      </table>
                    </td>

                    <td>
                      <table class="table table-light">
                        <tbody>
                          {% if ship_id >0 %}
                          {% for n in range(1, num_medslots+1) %}
                            <tr>
                              <td class="noBorder py-0 bg-info">
                                <select name="med{{n}}" class="form-control form-control-sm" style="max-width: 400px;">
                                  {% if myFittingsMed %}
                                    {% if myFittingsMed[n-1].component_id > 0 %}
                                    <option selected value="{{myFittingsMed[n-1].component_id}}">{{myFittingsMed[n-1].component}}</option>
                                    {% else %}
                                    <option selected value="0">Choose...</option>
                                    {% endif %}
                                  {% else %}
                                    <option selected value="0">Choose...</option>
                                  {% endif %}
                                  {% for module in med_modules %}
                                    <option value="{{module.id}}">{{module.item}}</option>
                                  {% endfor %}
                                </select>
                              </td>
                            </tr>
                            {% endfor %}
                          {% endif %}
                        </tbody>
                      </table>
                    </td>

                    <td>
                      <table class="table table-light">
                        <tbody>
                          {% if ship_id >0 %}
                          {% for n in range(1, num_lowslots+1) %}
                            <tr>
                              <td class="noBorder py-0 bg-info">
                                <select name="low{{n}}" class="form-control form-control-sm" style="max-width: 400px;">
                                  {% if myFittingsLow %}
                                    {% if myFittingsLow[n-1].component_id > 0 %}
                                    <option selected value="{{myFittingsLow[n-1].component_id}}">{{myFittingsLow[n-1].component}}</option>
                                    {% else %}
                                    <option selected value="0">Choose...</option>
                                    {% endif %}
                                  {% else %}
                                    <option selected value="0">Choose...</option>
                                  {% endif %}
                                  {% for module in low_modules %}
                                    <option value="{{module.id}}">{{module.item}}</option>
                                  {% endfor %}
                                </select>
                              </td>
                            </tr>
                            {% endfor %}
                          {% endif %}
                        </tbody>
                      </table>
                    </td>
                  </tr>

                  <tr>
                    <td class="text-center"><strong>Rig Slots</td>
                    <td class="text-center"><strong>Ammo</td>
                    <td class="text-center"><strong>Drones</td>
                  </tr>

                  <tr>
                    <td>
                      <table class="table table-light">
                        <tbody>
                          {% if ship_id >0 %}
                          {% for n in range(1, num_rigslots+1) %}
                            <tr>
                              <td class="noBorder py-0 bg-info">
                                <select name="rig{{n}}" class="form-control form-control-sm" style="max-width: 400px;">
                                  {% if myFittingsRig %}
                                    {% if myFittingsRig[n-1].component_id > 0 %}
                                    <option selected value="{{myFittingsRig[n-1].component_id}}">{{myFittingsRig[n-1].component}}</option>
                                    {% else %}
                                    <option selected value="0">Choose...</option>
                                    {% endif %}
                                  {% else %}
                                    <option selected value="0">Choose...</option>
                                  {% endif %}
                                  {% for module in rig_modules %}
                                    <option value="{{module.id}}">{{module.item}}</option>
                                  {% endfor %}
                                </select>
                              </td>
                            </tr>
                            {% endfor %}
                          {% endif %}
                        </tbody>
                      </table>
                    </td>

                    <td>
                      <table class="table table-light">
                        <tbody>
                          {% if ship_id >0 %}
                          {% for n in range(1, 6) %}
                            <tr>
                              <td class="noBorder py-0 bg-info">
                                <select name="ammo{{n}}" class="form-control form-control-sm" style="max-width: 400px;">
                                  {% if myFittingsAmmo %}
                                    {% if myFittingsAmmo[n-1].component_id > 0 %}
                                      <option selected value="{{myFittingsAmmo[n-1].component_id}}">{{myFittingsAmmo[n-1].component}}</option>
                                    {% else %}
                                      <option selected value="0">Choose...</option>
                                    {% endif %}
                                  {% else %}
                                    <option selected value="0">Choose...</option>
                                  {% endif %}
                                  {% for module in ammos %}
                                    <option value="{{module.id}}">{{module.item}}</option>
                                  {% endfor %}
                                </select>
                              </td>
                              <td class="noBorder py-0 bg-info">
                                {% if myFittingsAmmo %}
                                  {% if myFittingsAmmo[n-1].component_id > 0 %}
                                    <input type="text" name="ammo_qty{{n}}" value="{{myFittingsAmmo[n-1].component_qty}}" size="1">
                                  {% else %}
                                    <input type="text" name="ammo_qty{{n}}" value="0" size="1">
                                  {% endif %}
                                {% else %}
                                  <input type="text" name="ammo_qty{{n}}" value="0" size="1">
                                {% endif %}
                              </td>
                            </tr>
                            {% endfor %}
                          {% endif %}
                        </tbody>
                      </table>
                    </td>
                    <td>
                      <table class="table table-light">
                        <tbody>
                          {% if ship_id >0 %}
                          {% for n in range(1, 6) %}
                            <tr>
                              <td class="noBorder py-0 bg-info">
                                <select name="drone{{n}}" class="form-control form-control-sm" style="max-width: 400px;">
                                  {% if myFittingsDrone %}
                                    {% if myFittingsDrone[n-1].component_id > 0 %}
                                      <option selected value="{{myFittingsDrone[n-1].component_id}}">{{myFittingsDrone[n-1].component}}</option>
                                    {% else %}
                                      <option selected value="0">Choose...</option>
                                    {% endif %}
                                  {% else %}
                                    <option selected value="0">Choose...</option>
                                  {% endif %}
                                  {% for module in drones %}
                                    <option value="{{module.id}}">{{module.item}}</option>
                                  {% endfor %}
                                </select>
                              </td>
                              <td class="noBorder py-0 bg-info">
                                {% if myFittingsDrone %}
                                  {% if myFittingsDrone[n-1].component_id > 0 %}
                                    <input type="text" name="drone_qty{{n}}" value="{{myFittingsDrone[n-1].component_qty}}" size="1">
                                  {% else %}
                                    <input type="text" name="drone_qty{{n}}" value="0" size="1">
                                  {% endif %}
                                {% else %}
                                  <input type="text" name="drone_qty{{n}}" value="0" size="1">
                                {% endif %}
                              </td>
                            </tr>
                            {% endfor %}
                          {% endif %}
                        </tbody>
                      </table>
                    </td>
                  </tr>

                  </form>
                  <tr>
                    <td class="text-center"><h4 class="text-danger"><strong>Cost of Production:</h4><h5>{{ "{:,.0f}".format(fittingCost) }}</td>
                    <td class="text-center"><h4 class="text-success"><strong>Contract Value:</h4><h5>{{ "{:,.0f}".format(myFittings[fittingIndex].qty * myFittings[fittingIndex].contract_sell_price) }}</td>
                    <td class="text-center"><h4 class="text-secondary"><strong>Profit Margin:</h4><h5> {{ "{:.2%}".format(fittingPM) }}</td>
                  </tr>
                </tbody>
              </table>

              <table class="table table-sm">
                <tbody>
                  <tr>
                    <td class="text-center noBorder py-0" colspan="6">
                      <h4 class="bg-secondary text-white">Production Rollup</h4>
                    </td>
                  </tr>
                  <tr>
                    <td class="text-center noBorder py-0" colspan="6">
                      <h5 class="bg-info text-white">Commodities to Purchase</h5>
                    </td>
                  </tr>
                  <tr>
                    <td class="noBorder py-0"><strong>Material</td>
                    <td class="noBorder py-0"><strong>QTY</td>
                    <td class="noBorder py-0"><strong>Jita Buy</td>
                    <td class="noBorder py-0"><strong>Material</td>
                    <td class="noBorder py-0"><strong>QTY</td>
                    <td class="noBorder py-0"><strong>Jita Buy</td>
                  </tr>
                  <tr>
                    {% for item in nonBuildableFittings %}
                      <td class="noBorder py-0">{{ item.component }}</td>
                      <td class="noBorder py-0">{{ item.qty }}</td>
                      <td class="noBorder py-0">{{ item.component_cost }}</td>
                    {% endfor %}
                  </tr>
                  <tr>
                    <td class="text-center noBorder py-0" colspan="6">
                      <h5 class="bg-info text-white">Buildable Products</h5>
                    </td>
                  </tr>
                  <tr>
                    <td class="noBorder py-0"><strong>Material</td>
                    <td class="noBorder py-0"><strong>QTY</td>
                    <td class="noBorder py-0"><strong>Production Cost</td>
                    <td class="noBorder py-0"><strong>Material</td>
                    <td class="noBorder py-0"><strong>QTY</td>
                    <td class="noBorder py-0"><strong>Production Cost</td>
                  </tr>
                  <tr>
                    <td class="noBorder py-0">Cerberus</td>
                    <td class="noBorder py-0">10</td>
                    <td class="noBorder py-0">260,442,419</td>
                    <td class="noBorder py-0">Cormorant</td>
                    <td class="noBorder py-0">50</td>
                    <td class="noBorder py-0">61,616,114</td>
                  </tr>
                  <tr>
                    <td class="noBorder py-0">Damage Control II</td>
                    <td class="noBorder py-0">100</td>
                    <td class="noBorder py-0">26,442,419</td>
                    <td class="noBorder py-0">Ballistic Control System II</td>
                    <td class="noBorder py-0">50</td>
                    <td class="noBorder py-0">616,114</td>
                  </tr><tr>
                    <td class="noBorder py-0">Capacitor Power Relay II</td>
                    <td class="noBorder py-0">100</td>
                    <td class="noBorder py-0">24,621,034</td>
                    <td class="noBorder py-0">Large Shield Extender II</td>
                    <td class="noBorder py-0">50,000</td>
                    <td class="noBorder py-0">17,187,500</td>
                  </tr>
                  <tr>
                    <td class="noBorder py-0">CAdaptive Invulnerability Field II</td>
                    <td class="noBorder py-0">50000</td>
                    <td class="noBorder py-0">14,196,000</td>
                    <td class="noBorder py-0">EM Ward Field II</td>
                    <td class="noBorder py-0">10</td>
                    <td class="noBorder py-0">-</td>
                  </tr>
                  <tr>
                    <td class="noBorder py-0">150mm Railgun II</td>
                    <td class="noBorder py-0">50000</td>
                    <td class="noBorder py-0">14,196,000</td>
                    <td class="noBorder py-0">Heavy Missile Launcher II</td>
                    <td class="noBorder py-0">60</td>
                    <td class="noBorder py-0">50,394,774</td>
                  </tr>
                  <tr align="center">
                    <td class="noBorder py-0" colspan="6">
                      <input name="addbom" class="btn-sm btn-info" type="button" value="Add to B.O.M.">
                    </td>
                  </tr>

                </tbody>
              </table>

            </div><!-- row2 -->

        </div> <!-- col-12 -->
      </li>
    </ul>
  </div>
</div>


</div> <!-- main -->
{% endblock %}
